# 第4章：QoS・Retain・Willを試す

## 📚 学習時間：1.5時間

この章では、MQTTの高度な機能（QoS、Retain、Last Will）を実際に試して、その違いを体験します。

---

## 🎯 学習目標

この章を完了すると、以下ができるようになります：

- ✅ QoS 0/1/2の違いを理解し、使い分けられる
- ✅ Retainメッセージの動作を理解し、使える
- ✅ Last Will機能を実装できる
- ✅ 実際のアプリケーションで適切な設定を選べる

---

## 📖 学習の進め方

### ステップ1：メインドキュメントを読む（1時間）

まず、以下のメインドキュメントを順番に読んで、実際に実験しながら進めてください。

**📘 [01_MQTT機能実践.md](./01_MQTT機能実践.md)** ← **ここから始める**

このドキュメントには以下の内容が含まれています：
1. QoS 0/1/2の実験と比較
2. Retainメッセージの動作確認
3. Last Will機能のテスト
4. 実践的な使用例

**重要**: それぞれの機能を実際に動かして、違いを体感してください。

---

### ステップ2：関連ドキュメントを参照（30分）

より詳しく知りたい機能があれば、以下のリファレンスを参照してください。

#### **📗 [02_QoS詳細解説.md](./02_QoS詳細解説.md)**
QoSレベルの詳細解説
- QoS 0/1/2の動作の違い
- ハンドシェイクの仕組み
- パフォーマンスへの影響
- 使い分けのガイドライン

**いつ読むか**: QoSの選び方を深く理解したいとき

---

#### **📙 [03_Retain詳細解説.md](./03_Retain詳細解説.md)**
Retain機能の詳細解説
- Retainの仕組み
- ユースケース
- 削除方法
- 注意点

**いつ読むか**: Retainの活用方法を知りたいとき

---

#### **📕 [04_LastWill詳細解説.md](./04_LastWill詳細解説.md)**
Last Will機能の詳細解説
- Last Willの仕組み
- 設定方法
- 実用例
- デバイス監視への応用

**いつ読むか**: Last Willの実装方法を詳しく知りたいとき

---

#### **📙 [05_実験コード集.md](./05_実験コード集.md)**
実践的な実験コード集
- QoS比較実験
- Retain動作確認
- Last Will監視システム
- 組み合わせ例

**いつ読むか**: 実装のヒントが欲しいとき

---

### ステップ3：理解度テストに挑戦（20分）

すべてのドキュメントを読み終えたら、理解度テストに挑戦してください。

**📝 [06_理解度テスト.md](./06_理解度テスト.md)**
- 全10問（選択式、記述式、実装問題）
- 詳しい解答と解説付き
- よくある間違いと復習ポイント

**合格基準**: 8問以上正解で第5章に進めます

---

## 🗂️ ドキュメント一覧

| ドキュメント | 種類 | 説明 | 読む順序 |
|:---|:---:|:---|:---:|
| **01_MQTT機能実践.md** | メイン | QoS、Retain、Last Willの実験 | **1番目** |
| **02_QoS詳細解説.md** | リファレンス | QoSレベルの詳細 | 必要に応じて |
| **03_Retain詳細解説.md** | リファレンス | Retain機能の詳細 | 必要に応じて |
| **04_LastWill詳細解説.md** | リファレンス | Last Will機能の詳細 | 必要に応じて |
| **05_実験コード集.md** | リファレンス | 実践的なコード例 | 必要に応じて |
| **06_理解度テスト.md** | テスト | 理解度確認テスト | **最後** |

---

## ⏱️ 推奨学習スケジュール

### 初心者向け（1.5時間）

| 時間 | 内容 | ドキュメント |
|:---:|:---|:---|
| **0:00-0:30** | QoSの実験 | 01_MQTT機能実践.md（前半） |
| **0:30-1:00** | RetainとLast Willの実験 | 01_MQTT機能実践.md（後半） |
| **1:00-1:10** | 実験コードを試す | 05_実験コード集.md |
| **1:10-1:30** | 理解度テスト | 06_理解度テスト.md |

### 経験者向け（1時間）

| 時間 | 内容 | ドキュメント |
|:---:|:---|:---|
| **0:00-0:30** | すべての機能を実験 | 01_MQTT機能実践.md |
| **0:30-0:45** | 応用的な実験 | 05_実験コード集.md |
| **0:45-1:00** | 理解度テスト | 06_理解度テスト.md |

---

## ✅ チェックリスト

この章を完了する前に、以下がすべてできることを確認してください：

### 実験
- [ ] QoS 0/1/2の違いを実験で確認した
- [ ] Retainメッセージの動作を確認した
- [ ] Last Will機能が動作することを確認した
- [ ] 各機能を組み合わせて使える

### 理解度
- [ ] QoS 0/1/2の使い分けを説明できる
- [ ] Retainメッセージの用途を理解している
- [ ] Last Willの仕組みを理解している
- [ ] 理解度テストで8問以上正解している

---

## 🆘 困ったときは

### 機能の詳細を知りたい場合
- [02_QoS詳細解説.md](./02_QoS詳細解説.md) を参照
- [03_Retain詳細解説.md](./03_Retain詳細解説.md) を参照
- [04_LastWill詳細解説.md](./04_LastWill詳細解説.md) を参照

### 実装のヒントが欲しい場合
- [05_実験コード集.md](./05_実験コード集.md) を参照

---

## 📊 学習成果

この章を完了すると：

✅ **技術的スキル**
- QoSレベルを適切に選択できる
- Retainメッセージを活用できる
- Last Will機能を実装できる

✅ **理解**
- MQTTの高度な機能の仕組み
- 信頼性とパフォーマンスのトレードオフ
- 実用的な設計パターン

✅ **実践力**
- 要件に応じた適切な設定ができる
- 堅牢なMQTTアプリケーションを設計できる

---

## 🚀 次のステップ

第4章が完了したら、第5章に進みましょう！

**次の章**: 第5章：応用演習と確認

第5章では、これまで学んだことを総動員して：
- 実用的なIoTシステムの構築
- センサー&ダッシュボードアプリ
- リアルタイムデータの可視化

---

## 📚 参考資料

- [MQTT仕様書](https://mqtt.org/mqtt-specification/)
- [paho-mqtt公式ドキュメント](https://www.eclipse.org/paho/index.php?page=clients/python/docs/index.php)

---

**前の章**: [第3章：Pythonでクライアント作成](../step3/00_学習ガイド.md)
