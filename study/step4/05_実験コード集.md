# å®Ÿé¨“ã‚³ãƒ¼ãƒ‰é›†

## ğŸ§ª æ¥½ã—ãè©¦ã›ã‚‹å®Ÿé¨“ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

### å®Ÿé¨“1ï¼šQoSæ€§èƒ½æ¯”è¼ƒãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

```python
# qos_benchmark.py
import paho.mqtt.client as mqtt
import time

client = mqtt.Client()
client.connect("localhost", 1883, 60)

num_messages = 100

for qos in [0, 1, 2]:
    start = time.time()

    for i in range(num_messages):
        client.publish(f"benchmark/qos{qos}", f"msg{i}", qos=qos)

    elapsed = time.time() - start
    avg = elapsed / num_messages * 1000  # ãƒŸãƒªç§’

    print(f"QoS {qos}: {elapsed:.4f}ç§’ | å¹³å‡ {avg:.2f}ms/msg")

client.disconnect()
```

---

### å®Ÿé¨“2ï¼šRetainå‰Šé™¤ãƒ„ãƒ¼ãƒ«

```python
# clear_retained.py
import paho.mqtt.client as mqtt

retained_topics = []

def on_message(client, userdata, msg):
    if msg.retain:
        retained_topics.append(msg.topic)
        print(f"ç™ºè¦‹: {msg.topic}")

client = mqtt.Client()
client.on_message = on_message
client.connect("localhost", 1883, 60)

# ã™ã¹ã¦ã®ãƒˆãƒ”ãƒƒã‚¯ã‚’è³¼èª­
client.subscribe("#")

print("Retainãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¤œç´¢ä¸­...")
client.loop_start()
time.sleep(3)  # 3ç§’å¾…æ©Ÿ
client.loop_stop()

print(f"\n{len(retained_topics)}å€‹ã®Retainãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç™ºè¦‹")
print("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ (y/n): ", end="")

if input().lower() == 'y':
    for topic in retained_topics:
        client.publish(topic, "", retain=True)
        print(f"å‰Šé™¤: {topic}")
    print("âœ… å®Œäº†")

client.disconnect()
```

---

### å®Ÿé¨“3ï¼šLast Willç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 

```python
# lastwill_monitor_system.py
import paho.mqtt.client as mqtt
from datetime import datetime

devices_status = {}

def on_message(client, userdata, msg):
    device = msg.topic.split('/')[1]
    status = msg.payload.decode()
    timestamp = datetime.now().strftime("%H:%M:%S")

    devices_status[device] = {
        "status": status,
        "time": timestamp
    }

    emoji = "ğŸŸ¢" if status == "ONLINE" else "ğŸ”´"
    print(f"[{timestamp}] {emoji} {device}: {status}")

    # ã‚¢ãƒ©ãƒ¼ãƒˆ
    if status == "OFFLINE":
        print(f"  âš ï¸  ã‚¢ãƒ©ãƒ¼ãƒˆ: {device}ãŒå¿œç­”ã—ã¾ã›ã‚“ï¼")

client = mqtt.Client("MonitoringSystem")
client.on_message = on_message
client.connect("localhost", 1883, 60)
client.subscribe("devices/+/status")

print("ğŸ“¡ ãƒ‡ãƒã‚¤ã‚¹ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•")
print("=" * 60)
client.loop_forever()
```

---

### å®Ÿé¨“4ï¼šå…¨æ©Ÿèƒ½çµ±åˆã‚»ãƒ³ã‚µãƒ¼

```python
# ultimate_sensor.py
import paho.mqtt.client as mqtt
import random
import time
import sys

SENSOR_ID = sys.argv[1] if len(sys.argv) > 1 else "Sensor01"

def on_connect(client, userdata, flags, rc):
    if rc == 0:
        # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’Retainã§é€ä¿¡ï¼ˆQoS 1ï¼‰
        client.publish(
            f"sensors/{SENSOR_ID}/status",
            "ONLINE",
            qos=1,
            retain=True
        )
        print(f"âœ… {SENSOR_ID} èµ·å‹•å®Œäº†")

client = mqtt.Client(SENSOR_ID)

# Last Willè¨­å®šï¼ˆQoS 2 + Retainï¼‰
client.will_set(
    f"sensors/{SENSOR_ID}/status",
    "OFFLINE",
    qos=2,
    retain=True
)

client.on_connect = on_connect
client.connect("localhost", 1883, 60)
client.loop_start()

print(f"ğŸŒ¡ï¸  {SENSOR_ID} ç¨¼åƒä¸­...")
print("ğŸ’¡ æ©Ÿèƒ½:")
print("  - Last Will (QoS 2 + Retain)")
print("  - æ¸©åº¦ãƒ‡ãƒ¼ã‚¿ (QoS 0)")
print("  - ç•°å¸¸ã‚¢ãƒ©ãƒ¼ãƒˆ (QoS 2)")
print()

try:
    while True:
        temp = round(random.uniform(15, 35), 1)

        # æ¸©åº¦ãƒ‡ãƒ¼ã‚¿ï¼ˆQoS 0: é«˜é€Ÿï¼‰
        client.publish(
            f"sensors/{SENSOR_ID}/temperature",
            str(temp),
            qos=0
        )

        # ç•°å¸¸å€¤ãƒã‚§ãƒƒã‚¯ï¼ˆQoS 2: ç¢ºå®Ÿï¼‰
        if temp < 18 or temp > 32:
            alert = f"ç•°å¸¸å€¤: {temp}Â°C"
            client.publish(
                f"sensors/{SENSOR_ID}/alert",
                alert,
                qos=2
            )
            print(f"ğŸš¨ {alert}")
        else:
            print(f"ğŸ“Š {temp}Â°C")

        time.sleep(2)
except KeyboardInterrupt:
    print(f"\nâš ï¸  ç•°å¸¸çµ‚äº†ï¼ˆLast WillãŒç™ºç«ã—ã¾ã™ï¼‰")
    exit(0)
```

---

### å®Ÿé¨“5ï¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼

```python
# message_counter.py
import paho.mqtt.client as mqtt

stats = {"qos0": 0, "qos1": 0, "qos2": 0, "retained": 0}

def on_message(client, userdata, msg):
    stats[f"qos{msg.qos}"] += 1
    if msg.retain:
        stats["retained"] += 1

    print(f"\rQoS0: {stats['qos0']} | "
          f"QoS1: {stats['qos1']} | "
          f"QoS2: {stats['qos2']} | "
          f"Retain: {stats['retained']}", end="")

client = mqtt.Client()
client.on_message = on_message
client.connect("localhost", 1883, 60)
client.subscribe("#")

print("ğŸ“Š ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼èµ·å‹•")
client.loop_forever()
```

---

ã©ã‚“ã©ã‚“è©¦ã—ã¦ã€MQTTã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ã‚‡ã†ï¼ğŸ‰
