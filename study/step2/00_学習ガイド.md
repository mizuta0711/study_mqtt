# 第2章：DockerでMQTT Brokerを構築

## 📚 学習時間：1.5時間

この章では、DockerでEclipse Mosquittoを起動し、MQTT Brokerの環境を構築します。

---

## 🎯 学習目標

この章を完了すると、以下ができるようになります：

- ✅ DockerでMosquitto brokerを起動できる
- ✅ mosquitto.confの基本設定を理解し、編集できる
- ✅ ボリュームマウントでデータを永続化できる
- ✅ Dockerコマンドでコンテナを管理できる
- ✅ ブローカーの動作確認とデバッグができる

---

## 📖 学習の進め方

### ステップ1：メインドキュメントを読む（45分）

まず、以下のメインドキュメントを順番に読んで、実際に手を動かしながら進めてください。

**📘 [01_Dockerブローカー構築.md](./01_Dockerブローカー構築.md)** ← **ここから始める**

このドキュメントには以下の内容が含まれています：
1. Eclipse Mosquittoとは
2. プロジェクト構造の準備
3. mosquitto.confの作成
4. Mosquittoイメージの取得
5. コンテナの起動
6. 動作確認
7. よく使うDockerコマンド

**重要**: ドキュメントを読むだけでなく、実際にコマンドを実行してください。

---

### ステップ2：関連ドキュメントを参照（30分）

メインドキュメントで分からないことがあれば、以下のリファレンスを参照してください。

#### **📗 [02_Mosquitto設定詳細.md](./02_Mosquitto設定詳細.md)**
mosquitto.confの詳細解説
- リスナー設定の詳細
- セキュリティ設定（認証、ACL）
- 永続化とログ設定
- TLS/SSL設定
- パフォーマンスチューニング
- 実践的な設定例

**いつ読むか**: 設定ファイルをカスタマイズしたいとき

---

#### **📕 [03_トラブルシューティング.md](./03_トラブルシューティング.md)**
トラブルシューティングガイド
- よくあるエラーと解決方法
- ポート競合の解決
- 設定ファイルのエラー対処
- 接続できない場合の診断
- デバッグ手法

**いつ読むか**: エラーが発生したとき、コンテナが起動しないとき

---

#### **📙 [04_Dockerコマンド集.md](./04_Dockerコマンド集.md)**
Dockerコマンドクイックリファレンス
- コンテナの基本操作（起動、停止、削除）
- ログ管理
- ボリューム管理
- ネットワーク管理
- トラブルシューティングコマンド
- 便利なエイリアス

**いつ読むか**: Dockerコマンドを忘れたとき、効率的な操作を知りたいとき

---

### ステップ3：理解度テストに挑戦（15分）

すべてのドキュメントを読み終えたら、理解度テストに挑戦してください。

**📝 [06_理解度テスト.md](./06_理解度テスト.md)**
- 全10問（選択式、記述式、実装問題）
- 詳しい解答と解説付き
- よくある間違いと復習ポイント

**合格基準**: 8問以上正解で次の章に進めます

---

## 🗂️ ドキュメント一覧

| ドキュメント | 種類 | 説明 | 読む順序 |
|:---|:---:|:---|:---:|
| **01_Dockerブローカー構築.md** | メイン | DockerでMosquittoを構築する手順 | **1番目** |
| **02_Mosquitto設定詳細.md** | リファレンス | 設定ファイルの詳細解説 | 必要に応じて |
| **03_トラブルシューティング.md** | リファレンス | エラー対処法とデバッグ | 問題発生時 |
| **04_Dockerコマンド集.md** | リファレンス | Dockerコマンド集 | 必要に応じて |
| **05_DockerCompose使い方.md** | リファレンス | Docker Composeの使い方 | 必要に応じて |
| **06_理解度テスト.md** | テスト | 理解度確認テスト | **最後** |

---

## ⏱️ 推奨学習スケジュール

### 初心者向け（1.5時間）

| 時間 | 内容 | ドキュメント |
|:---:|:---|:---|
| **0:00-0:45** | メインドキュメントを読みながら環境構築 | 01_Dockerブローカー構築.md |
| **0:45-1:00** | 動作確認とテスト | 01_Dockerブローカー構築.md（ステップ5-6） |
| **1:00-1:15** | 理解度テスト | 06_理解度テスト.md |
| **1:15-1:30** | 間違えた部分の復習 | 各リファレンス |

### 経験者向け（1時間）

| 時間 | 内容 | ドキュメント |
|:---:|:---|:---|
| **0:00-0:30** | メインドキュメントを流し読み、環境構築 | 01_Dockerブローカー構築.md |
| **0:30-0:45** | 応用設定を試す | 02_Mosquitto設定詳細.md |
| **0:45-1:00** | 理解度テスト | 06_理解度テスト.md |

---

## ✅ チェックリスト

この章を完了する前に、以下がすべてできることを確認してください：

### 環境構築
- [ ] `mqtt/config`、`mqtt/data`、`mqtt/log` ディレクトリが作成されている
- [ ] `mosquitto.conf` が正しく作成されている
- [ ] `docker pull eclipse-mosquitto` が成功している
- [ ] コンテナが起動し、`docker ps` で確認できる

### 動作確認
- [ ] `docker logs mqtt-broker` でエラーがない
- [ ] コンテナ内で `mosquitto_sub/pub` のテストが成功
- [ ] 外部クライアント（MQTT ExplorerまたはPython）から接続できる

### Docker操作
- [ ] コンテナを起動・停止・再起動できる
- [ ] ログをリアルタイムで確認できる
- [ ] コンテナ内でコマンドを実行できる

### 理解度
- [ ] ポートマッピング（`-p`）の意味を理解している
- [ ] ボリュームマウント（`-v`）の役割を理解している
- [ ] `mosquitto.conf` の基本設定を説明できる
- [ ] 理解度テストで8問以上正解している

---

## 🆘 困ったときは

### エラーが発生した場合
1. まず [03_トラブルシューティング.md](./03_トラブルシューティング.md) を確認
2. `docker logs mqtt-broker` でエラーメッセージを確認
3. エラーメッセージでGoogle検索

### コマンドを忘れた場合
- [04_Dockerコマンド集.md](./04_Dockerコマンド集.md) を参照

### 設定が分からない場合
- [02_Mosquitto設定詳細.md](./02_Mosquitto設定詳細.md) を参照

---

## 📊 学習成果

この章を完了すると：

✅ **技術的スキル**
- Dockerの基本操作ができる
- mosquitto.confを編集できる
- MQTTブローカーを管理できる

✅ **理解**
- ボリュームマウントの重要性
- ログの確認方法
- トラブルシューティングの基本

✅ **実践力**
- 開発環境のセットアップができる
- 問題が発生しても自力で解決できる

---

## 🚀 次のステップ

第2章が完了したら、第3章に進みましょう！

**次の章**: [第3章：Pythonクライアントの実装](../step3/00_学習ガイド.md)

第3章では、今回構築したMQTT Brokerに接続するPythonクライアントを実装します。
- Publisher（送信側）の実装
- Subscriber（受信側）の実装
- QoS、Retain、Last Willの実践

---

## 📚 参考資料

- [Eclipse Mosquitto公式ドキュメント](https://mosquitto.org/documentation/)
- [Docker公式ドキュメント](https://docs.docker.com/)
- [MQTT.org - Getting Started](https://mqtt.org/getting-started/)

---

**前の章**: [第1章：MQTTの基礎理解](../step1/01_MQTT基礎知識.md)
