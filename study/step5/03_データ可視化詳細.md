# ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–è©³ç´°

## ğŸ¯ ã“ã®ç« ã®å†…å®¹

matplotlibã‚’ä½¿ã£ãŸé«˜åº¦ãªãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã®æ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚

---

## ğŸ“Š åŸºæœ¬çš„ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚°ãƒ©ãƒ•

### matplotlib ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿

```python
import matplotlib.pyplot as plt
import matplotlib.animation as animation

fig, ax = plt.subplots()
line, = ax.plot([], [])

def init():
    """åˆæœŸåŒ–é–¢æ•°"""
    ax.set_xlim(0, 100)
    ax.set_ylim(0, 50)
    return line,

def update(frame):
    """æ›´æ–°é–¢æ•°ï¼ˆæ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‘¼ã°ã‚Œã‚‹ï¼‰"""
    # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
    line.set_data(x_data, y_data)
    return line,

# ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
ani = animation.FuncAnimation(
    fig, update, init_func=init,
    interval=1000,  # 1000ms = 1ç§’
    blit=True  # é«˜é€ŸåŒ–
)

plt.show()
```

---

## ğŸ“ˆ è¤‡æ•°ã‚°ãƒ©ãƒ•ã®è¡¨ç¤º

### ã‚µãƒ–ãƒ—ãƒ­ãƒƒãƒˆã§è¤‡æ•°ã®ã‚»ãƒ³ã‚µãƒ¼ã‚’è¡¨ç¤º

```python
fig, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(10, 10))

# æ¸©åº¦ã‚°ãƒ©ãƒ•
ax1.set_ylabel('æ¸©åº¦ (Â°C)')
ax1.set_title('æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼')
line1, = ax1.plot([], [], 'r-')

# æ¹¿åº¦ã‚°ãƒ©ãƒ•
ax2.set_ylabel('æ¹¿åº¦ (%)')
ax2.set_title('æ¹¿åº¦ã‚»ãƒ³ã‚µãƒ¼')
line2, = ax2.plot([], [], 'b-')

# ç…§åº¦ã‚°ãƒ©ãƒ•
ax3.set_ylabel('ç…§åº¦ (lux)')
ax3.set_title('ç…§åº¦ã‚»ãƒ³ã‚µãƒ¼')
ax3.set_xlabel('æ™‚åˆ»')
line3, = ax3.plot([], [], 'g-')

def update(frame):
    line1.set_data(range(len(temp_data)), temp_data)
    line2.set_data(range(len(humid_data)), humid_data)
    line3.set_data(range(len(light_data)), light_data)
    return line1, line2, line3
```

**ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«**: [../../mqtt_clients/step5/multi_graph_dashboard.py](../../mqtt_clients/step5/multi_graph_dashboard.py)

---

## ğŸ¨ ã‚°ãƒ©ãƒ•ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### 1. ã‚«ãƒ©ãƒ¼è¨­å®š

```python
# ç·šã®è‰²ã¨ã‚¹ã‚¿ã‚¤ãƒ«
line, = ax.plot([], [], 'b-', linewidth=2)  # é’ã€å®Ÿç·šã€å¤ªã•2
line, = ax.plot([], [], 'r--', linewidth=1.5)  # èµ¤ã€ç ´ç·š
line, = ax.plot([], [], 'g:', marker='o')  # ç·‘ã€ç‚¹ç·šã€ãƒãƒ¼ã‚«ãƒ¼ä»˜ã

# èƒŒæ™¯è‰²
ax.set_facecolor('#f0f0f0')  # è–„ã„ã‚°ãƒ¬ãƒ¼

# ã‚°ãƒªãƒƒãƒ‰
ax.grid(True, alpha=0.3, linestyle='--')
```

### 2. æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®š

```python
import matplotlib.pyplot as plt

# æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®šï¼ˆç’°å¢ƒã«ã‚ˆã£ã¦ç•°ãªã‚‹ï¼‰
plt.rcParams['font.family'] = 'MS Gothic'  # Windows
# plt.rcParams['font.family'] = 'Hiragino Sans'  # macOS
# plt.rcParams['font.family'] = 'Noto Sans CJK JP'  # Linux

# ã¾ãŸã¯å€‹åˆ¥ã«æŒ‡å®š
ax.set_title('æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼', fontsize=14, fontfamily='MS Gothic')
```

### 3. å‹•çš„ãªè»¸ç¯„å›²èª¿æ•´

```python
def update(frame):
    if len(temperature_data) > 0:
        # ãƒ‡ãƒ¼ã‚¿ã«åˆã‚ã›ã¦Yè»¸ã‚’èª¿æ•´
        min_temp = min(temperature_data) - 2
        max_temp = max(temperature_data) + 2
        ax.set_ylim(min_temp, max_temp)

        # Xè»¸ã‚‚ãƒ‡ãƒ¼ã‚¿é‡ã«åˆã‚ã›ã‚‹
        ax.set_xlim(0, len(temperature_data))
```

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºæ–¹æ³•

### 1. çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤º

```python
def update(frame):
    if len(temperature_data) > 0:
        # çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—
        latest = temperature_data[-1]
        avg = sum(temperature_data) / len(temperature_data)
        min_val = min(temperature_data)
        max_val = max(temperature_data)

        # ã‚¿ã‚¤ãƒˆãƒ«ã«è¡¨ç¤º
        ax.set_title(
            f'æ¸©åº¦: {latest:.1f}Â°C '
            f'(å¹³å‡: {avg:.1f}Â°C, æœ€å°: {min_val:.1f}Â°C, æœ€å¤§: {max_val:.1f}Â°C)',
            fontsize=10
        )
```

### 2. é–¾å€¤ãƒ©ã‚¤ãƒ³ã®è¡¨ç¤º

```python
# é–¾å€¤ãƒ©ã‚¤ãƒ³ã‚’è¿½åŠ 
ax.axhline(y=28.0, color='r', linestyle='--', label='é«˜æ¸©è­¦å‘Š')
ax.axhline(y=18.0, color='b', linestyle='--', label='ä½æ¸©è­¦å‘Š')
ax.legend(loc='upper right')
```

### 3. ãƒ†ã‚­ã‚¹ãƒˆæ³¨é‡ˆ

```python
# æœ€æ–°å€¤ã‚’å¼·èª¿è¡¨ç¤º
if len(temperature_data) > 0:
    latest_x = len(temperature_data) - 1
    latest_y = temperature_data[-1]

    ax.annotate(
        f'{latest_y:.1f}Â°C',
        xy=(latest_x, latest_y),
        xytext=(10, 10),
        textcoords='offset points',
        bbox=dict(boxstyle='round', facecolor='yellow', alpha=0.7),
        fontsize=12,
        fontweight='bold'
    )
```

---

## ğŸ• æ™‚åˆ»è»¸ã®è¡¨ç¤º

### datetimeã‚’ä½¿ã£ãŸæ™‚åˆ»è¡¨ç¤º

```python
from datetime import datetime
import matplotlib.dates as mdates

# æ™‚åˆ»ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
time_data = deque(maxlen=50)
temp_data = deque(maxlen=50)

def on_message(client, userdata, msg):
    if msg.topic == "sensor/temperature":
        temp = float(msg.payload.decode())
        time_data.append(datetime.now())
        temp_data.append(temp)

def update(frame):
    if len(time_data) > 0:
        line.set_data(time_data, temp_data)

        # æ™‚åˆ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        ax.xaxis.set_major_formatter(mdates.DateFormatter('%H:%M:%S'))
        ax.xaxis.set_major_locator(mdates.SecondLocator(interval=10))
        fig.autofmt_xdate()  # æ™‚åˆ»ãƒ©ãƒ™ãƒ«ã‚’æ–œã‚ã«

    return line,
```

---

## ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜

### 1. ã‚°ãƒ©ãƒ•ã‚’ç”»åƒã¨ã—ã¦ä¿å­˜

```python
# ãƒœã‚¿ãƒ³ã§ä¿å­˜ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
from matplotlib.widgets import Button

def save_plot(event):
    """ã‚°ãƒ©ãƒ•ã‚’ä¿å­˜"""
    filename = f'temperature_{datetime.now().strftime("%Y%m%d_%H%M%S")}.png'
    plt.savefig(filename, dpi=300, bbox_inches='tight')
    print(f"âœ… ä¿å­˜: {filename}")

# ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
ax_button = plt.axes([0.8, 0.01, 0.1, 0.05])
button = Button(ax_button, 'ä¿å­˜')
button.on_clicked(save_plot)
```

### 2. ãƒ‡ãƒ¼ã‚¿ã‚’CSVã«ä¿å­˜

```python
import csv

def save_data_to_csv():
    """ãƒ‡ãƒ¼ã‚¿ã‚’CSVã«ä¿å­˜"""
    filename = f'data_{datetime.now().strftime("%Y%m%d_%H%M%S")}.csv'
    with open(filename, 'w', newline='', encoding='utf-8') as f:
        writer = csv.writer(f)
        writer.writerow(['æ™‚åˆ»', 'æ¸©åº¦'])
        for t, temp in zip(time_data, temperature_data):
            writer.writerow([t.isoformat(), temp])
    print(f"âœ… ãƒ‡ãƒ¼ã‚¿ä¿å­˜: {filename}")
```

---

## ğŸ® ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½

### 1. ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³æ©Ÿèƒ½

```python
# matplotlibã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ„ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–
# ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã€ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³å¯èƒ½
plt.show()
```

### 2. ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ

```python
def on_click(event):
    """ã‚°ãƒ©ãƒ•ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†"""
    if event.xdata is not None and event.ydata is not None:
        print(f"ã‚¯ãƒªãƒƒã‚¯ä½ç½®: ({event.xdata:.1f}, {event.ydata:.2f})")

fig.canvas.mpl_connect('button_press_event', on_click)
```

### 3. ä¸€æ™‚åœæ­¢ãƒ»å†é–‹æ©Ÿèƒ½

```python
paused = False

def on_key(event):
    """ã‚­ãƒ¼å…¥åŠ›ã®å‡¦ç†"""
    global paused
    if event.key == ' ':  # ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼
        paused = not paused
        status = "ä¸€æ™‚åœæ­¢" if paused else "å†é–‹"
        print(f"â¸ï¸  {status}")

fig.canvas.mpl_connect('key_press_event', on_key)

def update(frame):
    if not paused:
        # é€šå¸¸ã®æ›´æ–°å‡¦ç†
        line.set_data(x_data, y_data)
    return line,
```

---

## ğŸŒˆ é«˜åº¦ãªãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

### è¤‡æ•°ã‚»ãƒ³ã‚µãƒ¼ã‚’çµ±åˆã—ãŸãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«**: [../../mqtt_clients/step5/advanced_dashboard.py](../../mqtt_clients/step5/advanced_dashboard.py)

ä¸»ãªæ©Ÿèƒ½ï¼š
- âœ… è¤‡æ•°ã‚°ãƒ©ãƒ•ã®åŒæ™‚è¡¨ç¤ºï¼ˆæ¸©åº¦ã€æ¹¿åº¦ã€ç…§åº¦ï¼‰
- âœ… çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤º
- âœ… é–¾å€¤ã‚¢ãƒ©ãƒ¼ãƒˆã®è¦–è¦šåŒ–
- âœ… ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜æ©Ÿèƒ½
- âœ… ã‚»ãƒ³ã‚µãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è¡¨ç¤º

---

## ğŸ”§ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. blitã‚ªãƒ—ã‚·ãƒ§ãƒ³

```python
# blit=True ã§é«˜é€ŸåŒ–ï¼ˆå¤‰æ›´éƒ¨åˆ†ã®ã¿å†æç”»ï¼‰
ani = animation.FuncAnimation(
    fig, update,
    interval=1000,
    blit=True  # â†ã“ã‚Œã‚’æœ‰åŠ¹ã«ã™ã‚‹
)
```

**æ³¨æ„**: `blit=True` ã‚’ä½¿ã†å ´åˆã€`update()` é–¢æ•°ã¯å¿…ãšã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã®ã‚¿ãƒ—ãƒ«ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```python
def update(frame):
    line.set_data(x_data, y_data)
    return line,  # â† ã‚«ãƒ³ãƒã‚’å¿˜ã‚Œãšã«ï¼ˆã‚¿ãƒ—ãƒ«ï¼‰
```

### 2. ãƒ‡ãƒ¼ã‚¿é‡ã®åˆ¶é™

```python
from collections import deque

# æœ€å¤§50å€‹ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ä¿æŒï¼ˆè‡ªå‹•çš„ã«å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ï¼‰
data = deque(maxlen=50)
```

### 3. æ›´æ–°é–“éš”ã®èª¿æ•´

```python
# æ›´æ–°é »åº¦ã‚’ä¸‹ã’ã‚‹ï¼ˆCPUã®è² è·è»½æ¸›ï¼‰
ani = animation.FuncAnimation(
    fig, update,
    interval=2000,  # 2ç§’ã”ã¨ã«æ›´æ–°
    blit=True
)
```

---

## ğŸ“± ä»–ã®å¯è¦–åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### 1. Plotlyï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚°ãƒ©ãƒ•ï¼‰

```python
import plotly.graph_objects as go
from plotly.subplots import make_subplots

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°å¯èƒ½ãªWebãƒ™ãƒ¼ã‚¹ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
fig = go.Figure(data=go.Scatter(y=temperature_data))
fig.show()
```

### 2. Dashï¼ˆWebãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰

```python
import dash
from dash import dcc, html

# Webãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
app = dash.Dash(__name__)
app.layout = html.Div([
    dcc.Graph(id='live-graph'),
    dcc.Interval(id='interval', interval=1000)
])
```

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ

- [ ] åŸºæœ¬çš„ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚°ãƒ©ãƒ•ã‚’å®Ÿè£…ã§ãã‚‹
- [ ] è¤‡æ•°ã®ã‚°ãƒ©ãƒ•ã‚’åŒæ™‚ã«è¡¨ç¤ºã§ãã‚‹
- [ ] ã‚°ãƒ©ãƒ•ã‚’é©åˆ‡ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã§ãã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ãŸå®Ÿè£…ãŒã§ãã‚‹

---

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:**
- [01_IoTã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰å®Ÿè·µ.md](./01_IoTã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰å®Ÿè·µ.md) - åŸºæœ¬å®Ÿè£…
- [05_å¿œç”¨ã‚³ãƒ¼ãƒ‰é›†.md](./05_å¿œç”¨ã‚³ãƒ¼ãƒ‰é›†.md) - å®Ÿè£…ä¾‹
