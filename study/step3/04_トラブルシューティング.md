# ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

## ğŸ”§ ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•

### ã‚¨ãƒ©ãƒ¼1: ModuleNotFoundError: No module named 'paho'

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
```
ModuleNotFoundError: No module named 'paho'
```

**åŸå› **: paho-mqttãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
pip install paho-mqtt
```

---

### ã‚¨ãƒ©ãƒ¼2: ConnectionRefusedError

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
```
ConnectionRefusedError: [Errno 111] Connection refused
```

**åŸå› **:
- MQTTãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ãŒèµ·å‹•ã—ã¦ã„ãªã„
- ãƒ›ã‚¹ãƒˆåã‚„ãƒãƒ¼ãƒˆç•ªå·ãŒé–“é•ã£ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:
```bash
# ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã®èµ·å‹•ç¢ºèª
docker ps | grep mqtt-broker

# èµ·å‹•ã—ã¦ã„ãªã„å ´åˆ
docker-compose up -d

# ãƒ›ã‚¹ãƒˆåã¨ãƒãƒ¼ãƒˆã‚’ç¢ºèª
BROKER = "localhost"  # ãƒ­ãƒ¼ã‚«ãƒ«ã®å ´åˆ
PORT = 1883           # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆ
```

---

### ã‚¨ãƒ©ãƒ¼3: decode() ã‚’å¿˜ã‚Œã‚‹

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
```
TypeError: a bytes-like object is required, not 'str'
```

**åŸå› **: `msg.payload`ã¯ãƒã‚¤ãƒˆåˆ—ãªã®ã§ã€æ–‡å­—åˆ—ã¨ã—ã¦æ‰±ã†ã«ã¯`decode()`ãŒå¿…è¦

**è§£æ±ºæ–¹æ³•**:
```python
# âŒ é–“é•ã„
message = msg.payload

# âœ… æ­£ã—ã„
message = msg.payload.decode('utf-8')
```

---

### ã‚¨ãƒ©ãƒ¼4: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå—ä¿¡ã§ããªã„

**ç¢ºèªäº‹é …**:

1. **SubscriberãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ï¼Ÿ**
2. **ãƒˆãƒ”ãƒƒã‚¯åãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ï¼Ÿ**
   ```python
   # Publisherã¨ãƒˆãƒ”ãƒƒã‚¯åã‚’å®Œå…¨ã«ä¸€è‡´ã•ã›ã‚‹
   ```
3. **`subscribe()`ã‚’å‘¼ã‚“ã§ã„ã‚‹ã‹ï¼Ÿ**
   ```python
   # on_connectå†…ã§å‘¼ã¶ã®ãŒå®‰å…¨
   def on_connect(client, userdata, flags, rc):
       client.subscribe("test/topic")
   ```
4. **`loop_forever()`ã‚’å‘¼ã‚“ã§ã„ã‚‹ã‹ï¼Ÿ**

---

### ã‚¨ãƒ©ãƒ¼5: Ctrl+Cã§çµ‚äº†ã§ããªã„

**åŸå› **: `loop_forever()`ãŒç„¡é™ãƒ«ãƒ¼ãƒ—

**è§£æ±ºæ–¹æ³•**:
```python
try:
    client.loop_forever()
except KeyboardInterrupt:
    print("çµ‚äº†ã—ã¾ã™")
    client.disconnect()
```

---

### ãƒ‡ãƒãƒƒã‚°æ‰‹æ³•

#### ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–

```python
client.on_log = lambda client, userdata, level, buf: print(f"LOG: {buf}")
client.enable_logger()
```

#### æ¥ç¶šçŠ¶æ…‹ã‚’ç¢ºèª

```python
def on_connect(client, userdata, flags, rc):
    print(f"æ¥ç¶šçµæœ: rc={rc}")
    if rc == 0:
        print("âœ… æˆåŠŸ")
    else:
        print(f"âŒ å¤±æ•—: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ {rc}")
```

---

**å‰ã®ç« **: [ãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./01_Pythonã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£….md)
