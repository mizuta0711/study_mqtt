# 第3章：Pythonでクライアント作成

## 📚 学習時間：2時間

この章では、PythonでMQTTクライアント（PublisherとSubscriber）を実装し、第2章で構築したMQTT Brokerと通信します。

---

## 🎯 学習目標

この章を完了すると、以下ができるようになります：

- ✅ paho-mqttライブラリをインストールして使える
- ✅ Publisherを実装してメッセージを送信できる
- ✅ Subscriberを実装してメッセージを受信できる
- ✅ コールバック関数を理解して使える
- ✅ Publisher/Subscriber間で通信できる

---

## 📖 学習の進め方

### ステップ1：メインドキュメントを読む（1時間30分）

まず、以下のメインドキュメントを順番に読んで、実際にコードを書きながら進めてください。

**📘 [01_Pythonクライアント実装.md](./01_Pythonクライアント実装.md)** ← **ここから始める**

このドキュメントには以下の内容が含まれています：
1. paho-mqttライブラリのインストール
2. 基本的なPublisherの実装
3. 基本的なSubscriberの実装
4. Publisher/Subscriber間の通信テスト
5. コールバック関数の詳細
6. エラーハンドリング

**重要**: ドキュメントを読むだけでなく、実際にコードを書いて動かしてください。

---

### ステップ2：関連ドキュメントを参照（30分）

メインドキュメントで分からないことがあれば、以下のリファレンスを参照してください。

#### **📗 [02_paho-mqtt詳細.md](./02_paho-mqtt詳細.md)**
paho-mqttライブラリの詳細解説
- Client()クラスの詳細
- 接続オプション
- メッセージ送信オプション
- 購読オプション
- コールバック関数一覧
- ループ処理の種類

**いつ読むか**: より高度な機能を使いたいとき

---

#### **📙 [03_サンプルコード集.md](./03_サンプルコード集.md)**
実践的なサンプルコード集
- 温度センサーシミュレータ
- 複数トピックの購読
- JSONメッセージの送受信
- タイムスタンプ付きメッセージ
- 接続状態の監視

**いつ読むか**: 実装のヒントが欲しいとき

---

#### **📕 [04_トラブルシューティング.md](./04_トラブルシューティング.md)**
トラブルシューティングガイド
- よくあるエラーと解決方法
- 接続できない場合の診断
- メッセージが受信できない
- Pythonのバージョン問題
- デバッグ手法

**いつ読むか**: エラーが発生したとき

---

### ステップ3：理解度テストに挑戦（20分）

すべてのドキュメントを読み終えたら、理解度テストに挑戦してください。

**📝 [05_理解度テスト.md](./05_理解度テスト.md)**
- 全10問（選択式、記述式、実装問題）
- 詳しい解答と解説付き
- よくある間違いと復習ポイント

**合格基準**: 8問以上正解で次の章に進めます

---

## 🗂️ ドキュメント一覧

| ドキュメント | 種類 | 説明 | 読む順序 |
|:---|:---:|:---|:---:|
| **01_Pythonクライアント実装.md** | メイン | Publisher/Subscriberの実装手順 | **1番目** |
| **02_paho-mqtt詳細.md** | リファレンス | ライブラリの詳細解説 | 必要に応じて |
| **03_サンプルコード集.md** | リファレンス | 実践的なコード例 | 必要に応じて |
| **04_トラブルシューティング.md** | リファレンス | エラー対処法とデバッグ | 問題発生時 |
| **05_理解度テスト.md** | テスト | 理解度確認テスト | **最後** |

---

## ⏱️ 推奨学習スケジュール

### 初心者向け（2時間）

| 時間 | 内容 | ドキュメント |
|:---:|:---|:---|
| **0:00-0:45** | paho-mqttのインストールとPublisher実装 | 01_Pythonクライアント実装.md（前半） |
| **0:45-1:30** | Subscriber実装と通信テスト | 01_Pythonクライアント実装.md（後半） |
| **1:30-1:40** | サンプルコードを試す | 03_サンプルコード集.md |
| **1:40-2:00** | 理解度テスト | 05_理解度テスト.md |

### 経験者向け（1.5時間）

| 時間 | 内容 | ドキュメント |
|:---:|:---|:---|
| **0:00-0:45** | メインドキュメントを流し読み、実装 | 01_Pythonクライアント実装.md |
| **0:45-1:10** | 応用的なサンプルを試す | 03_サンプルコード集.md |
| **1:10-1:30** | 理解度テスト | 05_理解度テスト.md |

---

## ✅ チェックリスト

この章を完了する前に、以下がすべてできることを確認してください：

### 環境構築
- [ ] Python 3.x がインストールされている
- [ ] pip が使える
- [ ] paho-mqttライブラリがインストールされている
- [ ] MQTT Broker（Mosquitto）が起動している

### 実装
- [ ] publisher.pyが作成され、メッセージを送信できる
- [ ] subscriber.pyが作成され、メッセージを受信できる
- [ ] 2つのターミナルで通信テストが成功する

### 理解度
- [ ] Clientクラスの基本的な使い方を理解している
- [ ] connect()、publish()、subscribe()を使える
- [ ] コールバック関数の役割を説明できる
- [ ] loop_forever()とloop_start()の違いを理解している
- [ ] 理解度テストで8問以上正解している

---

## 🆘 困ったときは

### エラーが発生した場合
1. まず [04_トラブルシューティング.md](./04_トラブルシューティング.md) を確認
2. エラーメッセージをGoogle検索
3. paho-mqttの[公式ドキュメント](https://www.eclipse.org/paho/index.php?page=clients/python/docs/index.php)を確認

### 実装のヒントが欲しい場合
- [03_サンプルコード集.md](./03_サンプルコード集.md) を参照

### ライブラリの詳細を知りたい場合
- [02_paho-mqtt詳細.md](./02_paho-mqtt詳細.md) を参照

---

## 📊 学習成果

この章を完了すると：

✅ **技術的スキル**
- Pythonでpaho-mqttを使える
- Publisher/Subscriberを実装できる
- MQTT通信の基本を理解している

✅ **理解**
- コールバック関数の仕組み
- 非同期処理の基本
- Pub/Sub型通信の実践

✅ **実践力**
- IoTアプリケーションの基礎を実装できる
- センサーとダッシュボードの通信を構築できる

---

## 🚀 次のステップ

第3章が完了したら、第4章に進みましょう！

**次の章**: [第4章：QoS・Retain・Willを試す](../step4/00_学習ガイド.md)

第4章では、MQTTの高度な機能を実践します：
- QoSレベル（0/1/2）の違いを実験
- Retainメッセージの動作確認
- Last Will機能のテスト

---

## 📚 参考資料

- [paho-mqtt公式ドキュメント](https://www.eclipse.org/paho/index.php?page=clients/python/docs/index.php)
- [Python公式ドキュメント](https://docs.python.org/ja/3/)
- [MQTT.org - Getting Started](https://mqtt.org/getting-started/)

---

**前の章**: [第2章：DockerでMQTT Brokerを構築](../step2/00_学習ガイド.md)
