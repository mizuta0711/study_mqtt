# å¿œç”¨ä¾‹7ï¼šãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ“Š æ¦‚è¦

MQTTã‚’ä½¿ã£ã¦ãƒ‡ãƒã‚¤ã‚¹ã‚’é éš”åˆ¶å¾¡ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã—ã€ãƒ‡ãƒã‚¤ã‚¹å´ã§å—ä¿¡ã—ã¦å‹•ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚

## ğŸ¯ å­¦ç¿’ç›®æ¨™

- ã‚³ãƒãƒ³ãƒ‰/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…
- ãƒ‡ãƒã‚¤ã‚¹åˆ¶å¾¡ã®åŸºç¤
- QoS 2ã®é‡è¦æ€§ã®ç†è§£
- åŒæ–¹å‘é€šä¿¡ã®å®Ÿè£…

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
07_remote_control/
â”œâ”€â”€ README.md              # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ remote_controller.py   # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆé€ä¿¡å´ï¼‰
â””â”€â”€ device_simulator.py    # ãƒ‡ãƒã‚¤ã‚¹ï¼ˆå—ä¿¡å´ï¼‰
```

## ğŸš€ å®Ÿè¡Œæ–¹æ³•

### 1. ãƒ‡ãƒã‚¤ã‚¹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®èµ·å‹•

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1: ãƒ‡ãƒã‚¤ã‚¹å´ã‚’èµ·å‹•
python mqtt_clients/step5/advance/07_remote_control/device_simulator.py
```

### 2. ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®èµ·å‹•

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’èµ·å‹•
python mqtt_clients/step5/advance/07_remote_control/remote_controller.py
```

## âœ¨ ä¸»ãªæ©Ÿèƒ½

### ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆé€ä¿¡å´ï¼‰
- âœ… **é›»æºåˆ¶å¾¡**: ãƒ‡ãƒã‚¤ã‚¹ã®ON/OFF
- âœ… **æ¸©åº¦è¨­å®š**: ç›®æ¨™æ¸©åº¦ã®å¤‰æ›´
- âœ… **ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´**: å†·æˆ¿/æš–æˆ¿/é€é¢¨
- âœ… **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª**: ãƒ‡ãƒã‚¤ã‚¹ã®çŠ¶æ…‹ã‚’å–å¾—

### ãƒ‡ãƒã‚¤ã‚¹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆå—ä¿¡å´ï¼‰
- âœ… **ã‚³ãƒãƒ³ãƒ‰å—ä¿¡**: åˆ¶å¾¡ã‚³ãƒãƒ³ãƒ‰ã‚’å—ä¿¡
- âœ… **å‹•ä½œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ**: å—ä¿¡ã—ãŸã‚³ãƒãƒ³ãƒ‰ã«å¿œã˜ã¦å‹•ä½œ
- âœ… **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é€ä¿¡**: ç¾åœ¨ã®çŠ¶æ…‹ã‚’å®šæœŸçš„ã«é€ä¿¡
- âœ… **å¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœã‚’è¿”ä¿¡

## ğŸ“Š ã‚³ãƒãƒ³ãƒ‰ãƒˆãƒ”ãƒƒã‚¯æ§‹é€ 

```
devices/{device_id}/commands/{command_type}
```

### ã‚³ãƒãƒ³ãƒ‰ä¾‹
| ãƒˆãƒ”ãƒƒã‚¯ | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ | èª¬æ˜ | QoS |
|:---|:---|:---|:---:|
| `devices/living-room/commands/power` | ON / OFF | é›»æºåˆ¶å¾¡ | 2 |
| `devices/living-room/commands/set-temp` | 25 | æ¸©åº¦è¨­å®š (Â°C) | 2 |
| `devices/living-room/commands/mode` | cool / heat / fan | ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´ | 2 |
| `devices/living-room/commands/status` | request | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¦æ±‚ | 1 |

## ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒˆãƒ”ãƒƒã‚¯æ§‹é€ 

```
devices/{device_id}/status/{status_type}
```

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¾‹
| ãƒˆãƒ”ãƒƒã‚¯ | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ | èª¬æ˜ |
|:---|:---|:---|
| `devices/living-room/status/power` | ON / OFF | é›»æºçŠ¶æ…‹ |
| `devices/living-room/status/temperature` | 25.5 | ç¾åœ¨æ¸©åº¦ (Â°C) |
| `devices/living-room/status/mode` | cool | ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ |

## ğŸ’¡ å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

### 1. ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ï¼ˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å´ï¼‰

```python
# é›»æºON
client.publish("devices/living-room/commands/power", "ON", qos=2)

# æ¸©åº¦è¨­å®š
client.publish("devices/living-room/commands/set-temp", "25", qos=2)

# ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´
client.publish("devices/living-room/commands/mode", "cool", qos=2)
```

### 2. ã‚³ãƒãƒ³ãƒ‰å—ä¿¡ï¼ˆãƒ‡ãƒã‚¤ã‚¹å´ï¼‰

```python
def on_message(client, userdata, msg):
    if msg.topic.endswith("/commands/power"):
        power = msg.payload.decode()
        if power == "ON":
            turn_on()
        elif power == "OFF":
            turn_off()

    elif msg.topic.endswith("/commands/set-temp"):
        temp = float(msg.payload.decode())
        set_target_temperature(temp)
```

### 3. QoS 2ã®é‡è¦æ€§

åˆ¶å¾¡ã‚³ãƒãƒ³ãƒ‰ã¯ **QoS 2** ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Š:
- ã‚³ãƒãƒ³ãƒ‰ãŒç¢ºå®Ÿã« **1å›ã ã‘** å®Ÿè¡Œã•ã‚Œã‚‹
- é‡è¤‡å®Ÿè¡Œã‚’é˜²ãï¼ˆä¾‹: é›»æºã®ON/OFFï¼‰
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ä¿¡é ¼æ€§ã‚’ä¿ã¤

## ğŸ® ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

### é›»æºåˆ¶å¾¡
```python
# é›»æºON
send_command("power", "ON")

# é›»æºOFF
send_command("power", "OFF")
```

### æ¸©åº¦è¨­å®š
```python
# 25Â°Cã«è¨­å®š
send_command("set-temp", "25")

# 28Â°Cã«è¨­å®š
send_command("set-temp", "28")
```

### ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´
```python
# å†·æˆ¿ãƒ¢ãƒ¼ãƒ‰
send_command("mode", "cool")

# æš–æˆ¿ãƒ¢ãƒ¼ãƒ‰
send_command("mode", "heat")

# é€é¢¨ãƒ¢ãƒ¼ãƒ‰
send_command("mode", "fan")
```

## ğŸ“Š å‹•ä½œä¾‹

### ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å´
```
=== MQTTãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ ===
ãƒ‡ãƒã‚¤ã‚¹ID: living-room

ã‚³ãƒãƒ³ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„:
1. é›»æºON
2. é›»æºOFF
3. æ¸©åº¦è¨­å®š
4. ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´ (cool/heat/fan)
5. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
6. çµ‚äº†

é¸æŠ (1-6): 1
ğŸ“¤ ã‚³ãƒãƒ³ãƒ‰é€ä¿¡: power = ON
```

### ãƒ‡ãƒã‚¤ã‚¹å´
```
ğŸ“¥ [15:30:45] ã‚³ãƒãƒ³ãƒ‰å—ä¿¡: power = ON
ğŸ”Œ é›»æºã‚’ONã«ã—ã¾ã—ãŸ
ğŸ“¤ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é€ä¿¡: power = ON
```

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹

### JSONã‚³ãƒãƒ³ãƒ‰ã®ä½¿ç”¨

```python
# ã‚³ãƒãƒ³ãƒ‰ã‚’JSONå½¢å¼ã§é€ä¿¡
import json

command = {
    "type": "set-temp",
    "value": 25,
    "mode": "cool",
    "timestamp": datetime.now().isoformat()
}

client.publish(
    "devices/living-room/commands",
    json.dumps(command),
    qos=2
)
```

### è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã®åˆ¶å¾¡

```python
# å…¨ãƒ‡ãƒã‚¤ã‚¹ã«ä¸€æ–‰é€ä¿¡
devices = ["living-room", "bedroom", "kitchen"]

for device_id in devices:
    client.publish(
        f"devices/{device_id}/commands/power",
        "OFF",
        qos=2
    )
```

### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¶å¾¡

```python
import schedule

# æ¯æ—¥7æ™‚ã«é›»æºON
schedule.every().day.at("07:00").do(
    lambda: send_command("power", "ON")
)

# æ¯æ—¥23æ™‚ã«é›»æºOFF
schedule.every().day.at("23:00").do(
    lambda: send_command("power", "OFF")
)
```

## ğŸ“ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

1. **ã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³**: ãƒªãƒ¢ãƒ¼ãƒˆåˆ¶å¾¡ã®åŸºæœ¬è¨­è¨ˆ
2. **QoS ã®é¸æŠ**: ä¿¡é ¼æ€§ãŒå¿…è¦ãªå ´é¢ã§ã®QoS 2ã®ä½¿ç”¨
3. **åŒæ–¹å‘é€šä¿¡**: ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å—ä¿¡
4. **ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†**: è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã®åˆ¶å¾¡
5. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: ã‚³ãƒãƒ³ãƒ‰å¤±æ•—æ™‚ã®å¯¾å¿œ

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [../../study/step5/04_å®Ÿè·µçš„ãªè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³.md](../../../../study/step5/04_å®Ÿè·µçš„ãªè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³.md)
- [../../study/step5/05_å¿œç”¨ã‚³ãƒ¼ãƒ‰é›†.md](../../../../study/step5/05_å¿œç”¨ã‚³ãƒ¼ãƒ‰é›†.md)
