# å¿œç”¨ä¾‹3ï¼šãƒªã‚¢ãƒ«ãªæ¸©åº¦å¤‰åŒ–ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼

## ğŸ“Š æ¦‚è¦

æ™‚åˆ»ã‚„å‰å›å€¤ã‚’è€ƒæ…®ã—ãŸã€ã‚ˆã‚Šç¾å®Ÿçš„ãªæ¸©åº¦å¤‰åŒ–ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ã‚»ãƒ³ã‚µãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ğŸ¯ å­¦ç¿’ç›®æ¨™

- ãƒªã‚¢ãƒ«ãªç’°å¢ƒãƒ‡ãƒ¼ã‚¿ã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°
- æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
- æ•°å­¦é–¢æ•°ã‚’ä½¿ã£ãŸå‘¨æœŸçš„ãªå¤‰åŒ–ã®å®Ÿè£…
- ã‚ˆã‚Šé«˜åº¦ãªã‚»ãƒ³ã‚µãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
03_realistic_sensor/
â”œâ”€â”€ README.md                        # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ realistic_sensor_publisher.py    # ãƒªã‚¢ãƒ«ãªã‚»ãƒ³ã‚µãƒ¼Publisher
```

## ğŸš€ å®Ÿè¡Œæ–¹æ³•

### 1. ã‚»ãƒ³ã‚µãƒ¼ã®èµ·å‹•

```bash
python mqtt_clients/step5/advance/03_realistic_sensor/realistic_sensor_publisher.py
```

### 2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç›£è¦–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
# åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’èµ·å‹•
python mqtt_clients/step5/advance/02_advanced_dashboard/advanced_dashboard.py
```

## âœ¨ ä¸»ãªæ©Ÿèƒ½

### ãƒªã‚¢ãƒ«ãªæ¸©åº¦ãƒ¢ãƒ‡ãƒ«
- âœ… **æ—¥å†…å¤‰å‹•**: æ™‚åˆ»ã«å¿œã˜ãŸåŸºæº–æ¸©åº¦ã®å¤‰åŒ–ï¼ˆæ­£å¼¦æ³¢ï¼‰
- âœ… **æ…£æ€§åŠ¹æœ**: æ€¥æ¿€ãªæ¸©åº¦å¤‰åŒ–ã‚’æŠ‘åˆ¶
- âœ… **ãƒ©ãƒ³ãƒ€ãƒ ãƒã‚¤ã‚º**: è‡ªç„¶ãªæºã‚‰ãã®è¿½åŠ 
- âœ… **ç¯„å›²åˆ¶é™**: ç¾å®Ÿçš„ãªæ¸©åº¦ç¯„å›²ã«åˆ¶é™

### è¿½åŠ æ©Ÿèƒ½
- âœ… **è¤‡æ•°ã‚»ãƒ³ã‚µãƒ¼**: æ¸©åº¦ã€æ¹¿åº¦ã€ç…§åº¦ã‚’åŒæ™‚ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
- âœ… **ç›¸é–¢é–¢ä¿‚**: ã‚»ãƒ³ã‚µãƒ¼é–“ã®ç›¸é–¢ï¼ˆé«˜æ¸©æ™‚ã¯æ¹¿åº¦ä¸Šæ˜‡ãªã©ï¼‰
- âœ… **æ™‚åˆ»ä¾å­˜**: ç…§åº¦ã¯æ˜¼é–“ã«é«˜ãã€å¤œé–“ã«ä½ã„

## ğŸŒ¡ï¸ æ¸©åº¦ãƒ¢ãƒ‡ãƒ«ã®è©³ç´°

### åŸºæº–æ¸©åº¦ã®è¨ˆç®—

```python
def get_base_temperature(self):
    """æ™‚åˆ»ã«å¿œã˜ãŸåŸºæº–æ¸©åº¦"""
    hour = datetime.now().hour
    # æ­£å¼¦æ³¢ã§æ—¥å†…å¤‰å‹•ï¼ˆåˆå¾Œ2æ™‚é ƒã«æœ€é«˜æ¸©åº¦ï¼‰
    base = 24.0 + 4.0 * math.sin(math.pi * (hour - 6) / 12)
    return base
```

**ç‰¹å¾´:**
- åˆå‰6æ™‚: ç´„20Â°Cï¼ˆæœ€ä½æ¸©åº¦ï¼‰
- åˆå¾Œ2æ™‚: ç´„28Â°Cï¼ˆæœ€é«˜æ¸©åº¦ï¼‰
- å¤œé–“: å¾ã€…ã«ä½ä¸‹

### æ¸©åº¦ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯

```python
def generate_temperature(self):
    """ãƒªã‚¢ãƒ«ãªæ¸©åº¦ç”Ÿæˆ"""
    base = self.get_base_temperature()

    # åŸºæº–æ¸©åº¦ã«å¾ã€…ã«è¿‘ã¥ãï¼ˆæ…£æ€§åŠ¹æœï¼‰
    self.current_temp += (base - self.current_temp) * 0.1

    # ãƒ©ãƒ³ãƒ€ãƒ ãªãƒã‚¤ã‚ºã‚’è¿½åŠ 
    self.current_temp += random.uniform(-0.3, 0.3)

    # ç¯„å›²åˆ¶é™ï¼ˆ15Â°Cã€œ35Â°Cï¼‰
    self.current_temp = max(15.0, min(35.0, self.current_temp))

    return round(self.current_temp, 2)
```

**ç‰¹å¾´:**
- æ…£æ€§ä¿‚æ•°: 0.1ï¼ˆã‚†ã£ãã‚Šã¨å¤‰åŒ–ï¼‰
- ãƒã‚¤ã‚ºå¹…: Â±0.3Â°C
- çµ¶å¯¾ç¯„å›²: 15Â°Cã€œ35Â°C

## ğŸ’§ æ¹¿åº¦ãƒ¢ãƒ‡ãƒ«

### æ¹¿åº¦ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯

```python
def generate_humidity(self):
    """ãƒªã‚¢ãƒ«ãªæ¹¿åº¦ç”Ÿæˆ"""
    # æ¸©åº¦ã¨é€†ç›¸é–¢ï¼ˆé«˜æ¸©æ™‚ã¯ä½æ¹¿åº¦ï¼‰
    temp_factor = (30.0 - self.current_temp) * 2.0

    # åŸºæº–æ¹¿åº¦ï¼ˆ50%ï¼‰+ æ¸©åº¦è£œæ­£
    base_humid = 50.0 + temp_factor

    # åŸºæº–å€¤ã«å¾ã€…ã«è¿‘ã¥ã
    self.current_humid += (base_humid - self.current_humid) * 0.05

    # ãƒã‚¤ã‚ºè¿½åŠ 
    self.current_humid += random.uniform(-1.5, 1.5)

    # ç¯„å›²åˆ¶é™ï¼ˆ20%ã€œ80%ï¼‰
    self.current_humid = max(20.0, min(80.0, self.current_humid))

    return round(self.current_humid, 1)
```

**ç‰¹å¾´:**
- æ¸©åº¦ã¨ã®é€†ç›¸é–¢: é«˜æ¸©æ™‚ã¯ä½æ¹¿åº¦
- æ…£æ€§ä¿‚æ•°: 0.05ï¼ˆæ¸©åº¦ã‚ˆã‚Šé…ã„å¤‰åŒ–ï¼‰
- ãƒã‚¤ã‚ºå¹…: Â±1.5%

## ğŸ’¡ ç…§åº¦ãƒ¢ãƒ‡ãƒ«

### ç…§åº¦ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯

```python
def generate_light(self):
    """ãƒªã‚¢ãƒ«ãªç…§åº¦ç”Ÿæˆ"""
    hour = datetime.now().hour

    # æ—¥ä¸­ï¼ˆ6æ™‚ã€œ18æ™‚ï¼‰ã¯é«˜ç…§åº¦
    if 6 <= hour < 18:
        # æ­£å¼¦æ³¢ã§æ—¥ä¸­ã®å¤‰åŒ–ï¼ˆæ­£åˆã«æœ€å¤§ï¼‰
        base_light = 500 + 400 * math.sin(math.pi * (hour - 6) / 12)
    else:
        # å¤œé–“ã¯ä½ç…§åº¦
        base_light = 50

    # åŸºæº–å€¤ã«è¿‘ã¥ã
    self.current_light += (base_light - self.current_light) * 0.1

    # ãƒã‚¤ã‚ºè¿½åŠ 
    self.current_light += random.uniform(-30, 30)

    # ç¯„å›²åˆ¶é™ï¼ˆ0ã€œ1000 luxï¼‰
    self.current_light = max(0, min(1000, self.current_light))

    return int(self.current_light)
```

**ç‰¹å¾´:**
- æ—¥ä¸­: 500ã€œ900 lux
- å¤œé–“: ç´„50 lux
- æ­£åˆã«æœ€é«˜ç…§åº¦

## ğŸ“Š æ™‚é–“å¤‰åŒ–ã‚°ãƒ©ãƒ•

### æ¸©åº¦ã®æ—¥å†…å¤‰å‹•
```
35Â°C |           ___
     |        __/   \__
30Â°C |     __/         \__
     |   _/               \_
25Â°C | _/                   \
     |/                       \
20Â°C +------------------------
     0  6  12  18  24 (æ™‚)
```

### ç…§åº¦ã®æ—¥å†…å¤‰å‹•
```
1000 |       _____
 lux |      /     \
 800 |     /       \
     |    /         \
 400 |   /           \
     |  /             \
   0 +--+-------------+--
     0  6  12  18  24 (æ™‚)
       å¤œ  æ˜¼é–“   å¤œ
```

## ğŸ’¡ å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

### 1. æ•°å­¦çš„ãªãƒ¢ãƒ‡ãƒªãƒ³ã‚°
```python
import math

# æ­£å¼¦æ³¢ã§å‘¨æœŸçš„ãªå¤‰åŒ–ã‚’è¡¨ç¾
value = base + amplitude * math.sin(math.pi * (hour - offset) / period)
```

### 2. æ…£æ€§åŠ¹æœã®å®Ÿè£…
```python
# ç¾åœ¨å€¤ã‚’ç›®æ¨™å€¤ã«å¾ã€…ã«è¿‘ã¥ã‘ã‚‹
current += (target - current) * damping_factor
```

### 3. ãƒã‚¤ã‚ºã®è¿½åŠ 
```python
# è‡ªç„¶ãªæºã‚‰ãã‚’è¿½åŠ 
value += random.uniform(-noise_range, noise_range)
```

## ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ

1. ã‚»ãƒ³ã‚µãƒ¼ãŒèµ·å‹•ã—ã€æ™‚åˆ»ã«å¿œã˜ãŸåˆæœŸå€¤ã‚’è¨­å®š
2. æ¸©åº¦ãŒæ™‚é–“ã¨ã¨ã‚‚ã«å¾ã€…ã«å¤‰åŒ–
3. æ¹¿åº¦ãŒæ¸©åº¦ã«é€£å‹•ã—ã¦å¤‰åŒ–
4. ç…§åº¦ãŒæ—¥ä¸­ã¯é«˜ãã€å¤œé–“ã¯ä½ã„
5. ã™ã¹ã¦ã®å€¤ã«è‡ªç„¶ãªæºã‚‰ããŒã‚ã‚‹

## ğŸ”§ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### æ¸©åº¦ã®å¤‰åŒ–é€Ÿåº¦ã‚’èª¿æ•´
```python
# æ…£æ€§ä¿‚æ•°ã‚’å¤‰æ›´ï¼ˆå¤§ãã„ã»ã©é€Ÿãå¤‰åŒ–ï¼‰
self.current_temp += (base - self.current_temp) * 0.2  # 0.1 â†’ 0.2
```

### ãƒã‚¤ã‚ºã®å¤§ãã•ã‚’èª¿æ•´
```python
# ãƒã‚¤ã‚ºå¹…ã‚’å¤‰æ›´
self.current_temp += random.uniform(-0.5, 0.5)  # Â±0.3 â†’ Â±0.5
```

### æ—¥å†…å¤‰å‹•ã®å¹…ã‚’èª¿æ•´
```python
# æ¸©åº¦å¤‰å‹•å¹…ã‚’å¤‰æ›´
base = 24.0 + 6.0 * math.sin(...)  # 4.0 â†’ 6.0ï¼ˆæŒ¯å¹…æ‹¡å¤§ï¼‰
```

## ğŸ“ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

1. **æ•°å­¦çš„ãƒ¢ãƒ‡ãƒªãƒ³ã‚°**: æ­£å¼¦æ³¢ã‚’ä½¿ã£ãŸå‘¨æœŸçš„ãªå¤‰åŒ–ã®è¡¨ç¾
2. **æ…£æ€§åŠ¹æœ**: æ€¥æ¿€ãªå¤‰åŒ–ã‚’æŠ‘åˆ¶ã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
3. **ãƒã‚¤ã‚ºã®è¿½åŠ **: ç¾å®Ÿçš„ãªãƒ‡ãƒ¼ã‚¿ã®æºã‚‰ãã®å†ç¾
4. **ã‚»ãƒ³ã‚µãƒ¼ç›¸é–¢**: è¤‡æ•°ã‚»ãƒ³ã‚µãƒ¼é–“ã®é–¢ä¿‚æ€§ã®ãƒ¢ãƒ‡ãƒ«åŒ–
5. **æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿**: æ™‚åˆ»ã«ä¾å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ

## ğŸ” æ¯”è¼ƒï¼šã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¢ãƒ‡ãƒ« vs ãƒªã‚¢ãƒ«ãªãƒ¢ãƒ‡ãƒ«

### ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¢ãƒ‡ãƒ«
```python
# å˜ç´”ãªãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
temp = random.uniform(20.0, 30.0)
```

**å•é¡Œç‚¹:**
- æ€¥æ¿€ã«å¤‰åŒ–ã™ã‚‹
- æ™‚åˆ»ã‚’è€ƒæ…®ã—ãªã„
- å‰å›å€¤ã¨ã®é€£ç¶šæ€§ãŒãªã„

### ãƒªã‚¢ãƒ«ãªãƒ¢ãƒ‡ãƒ«
```python
# æ…£æ€§ + æ™‚åˆ»ä¾å­˜ + ãƒã‚¤ã‚º
base = get_base_by_time()
current += (base - current) * 0.1
current += random.uniform(-0.3, 0.3)
```

**åˆ©ç‚¹:**
- æ»‘ã‚‰ã‹ã«å¤‰åŒ–ã™ã‚‹
- æ™‚åˆ»ã«å¿œã˜ãŸå¤‰åŒ–
- è‡ªç„¶ãªæºã‚‰ã

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [../../study/step5/02_ã‚»ãƒ³ã‚µãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è©³ç´°.md](../../../../study/step5/02_ã‚»ãƒ³ã‚µãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è©³ç´°.md)
- [../../study/step5/05_å¿œç”¨ã‚³ãƒ¼ãƒ‰é›†.md](../../../../study/step5/05_å¿œç”¨ã‚³ãƒ¼ãƒ‰é›†.md)
